# Methods and Analysis

*In this section we explain the process and techniques used, including data cleaning, data exploration and visualization, insights gained, and the modeling approach.*

## Preparing the data

As we mention,in the description of the dataset is the description of the 279 measurement present in the dataset. The first task it is to set this definition in the name of the column and later set its values according to the one in the description: lineal or nominal, in our case numeric or factor. For that we review the output of the structure created when we read the dataset from UCI.

```{r Analysis setting colnames, include = FALSE}


# Because we have too many columns prefer make one by one to decrease error setting instead to set all of then in one sentence like 
# colnames(arrhythmia.uci) <- c("Age", "Sex", "Height", "Weight", .....)

colnames(arrhythmia.uci)[001] <- "Age"
colnames(arrhythmia.uci)[002] <- "Sex"
colnames(arrhythmia.uci)[003] <- "Height"
colnames(arrhythmia.uci)[004] <- "Weight"
colnames(arrhythmia.uci)[005] <- "QRS duration"
colnames(arrhythmia.uci)[006] <- "P-R interval"
colnames(arrhythmia.uci)[007] <- "Q-T interval"
colnames(arrhythmia.uci)[008] <- "T interval"
colnames(arrhythmia.uci)[009] <- "P interval"
colnames(arrhythmia.uci)[010] <- "QRS Vector angles"
colnames(arrhythmia.uci)[011] <- "T Vector angles"
colnames(arrhythmia.uci)[012] <- "P Vector angles"
colnames(arrhythmia.uci)[013] <- "QRST Vector angles"
colnames(arrhythmia.uci)[014] <- "J Vector angles"
colnames(arrhythmia.uci)[015] <- "Heart rate"
colnames(arrhythmia.uci)[016] <- "Channel DI Q wave Average"
colnames(arrhythmia.uci)[017] <- "Channel DI R wave Average"
colnames(arrhythmia.uci)[018] <- "Channel DI S wave Average"
colnames(arrhythmia.uci)[019] <- "Channel DI R' wave Average"
colnames(arrhythmia.uci)[020] <- "Channel DI S' Average"
colnames(arrhythmia.uci)[021] <- "Channel DI Number of intrinsic deflections"
colnames(arrhythmia.uci)[022] <- "Channel DI Existence of ragged R wave"
colnames(arrhythmia.uci)[023] <- "Channel DI Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[024] <- "Channel DI Existence of ragged P wave"
colnames(arrhythmia.uci)[025] <- "Channel DI Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[026] <- "Channel DI Existence of ragged T wave"
colnames(arrhythmia.uci)[027] <- "Channel DI Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[028] <- "Channel DII Q wave Average"
colnames(arrhythmia.uci)[029] <- "Channel DII R wave Average"
colnames(arrhythmia.uci)[030] <- "Channel DII S wave Average"
colnames(arrhythmia.uci)[031] <- "Channel DII R' wave Average"
colnames(arrhythmia.uci)[032] <- "Channel DII S' wave Average"
colnames(arrhythmia.uci)[033] <- "Channel DII Number of intrinsic deflections"
colnames(arrhythmia.uci)[034] <- "Channel DII Existence of ragged R wave"
colnames(arrhythmia.uci)[035] <- "Channel DII Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[036] <- "Channel DII Existence of ragged P wave"
colnames(arrhythmia.uci)[037] <- "Channel DII Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[038] <- "Channel DII Existence of ragged T wave"
colnames(arrhythmia.uci)[039] <- "Channel DII Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[040] <- "Channel DIII Q wave Average"
colnames(arrhythmia.uci)[041] <- "Channel DIII R wave Average"
colnames(arrhythmia.uci)[042] <- "Channel DIII S wave Average"
colnames(arrhythmia.uci)[043] <- "Channel DIII R' wave Average"
colnames(arrhythmia.uci)[044] <- "Channel DIII S' wave Average"
colnames(arrhythmia.uci)[045] <- "Channel DIII Number of intrinsic deflections"
colnames(arrhythmia.uci)[046] <- "Channel DIII Existence of ragged R wave"
colnames(arrhythmia.uci)[047] <- "Channel DIII Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[048] <- "Channel DIII Existence of ragged P wave"
colnames(arrhythmia.uci)[049] <- "Channel DIII Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[050] <- "Channel DIII Existence of ragged T wave"
colnames(arrhythmia.uci)[051] <- "Channel DIII Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[052] <- "Channel AVR Q wave Average"
colnames(arrhythmia.uci)[053] <- "Channel AVR R wave Average"
colnames(arrhythmia.uci)[054] <- "Channel AVR S wave Average"
colnames(arrhythmia.uci)[055] <- "Channel AVR R' wave Average"
colnames(arrhythmia.uci)[056] <- "Channel AVR S' wave Average"
colnames(arrhythmia.uci)[057] <- "Channel AVR Number of intrinsic deflections"
colnames(arrhythmia.uci)[058] <- "Channel AVR Existence of ragged R wave"
colnames(arrhythmia.uci)[059] <- "Channel AVR Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[060] <- "Channel AVR Existence of ragged P wave"
colnames(arrhythmia.uci)[061] <- "Channel AVR Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[062] <- "Channel AVR Existence of ragged T wave"
colnames(arrhythmia.uci)[063] <- "Channel AVR Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[064] <- "Channel AVL Q wave Average"
colnames(arrhythmia.uci)[065] <- "Channel AVL R wave Average"
colnames(arrhythmia.uci)[066] <- "Channel AVL S wave Average"
colnames(arrhythmia.uci)[067] <- "Channel AVL R' wave Average"
colnames(arrhythmia.uci)[068] <- "Channel AVL S' wave Average"
colnames(arrhythmia.uci)[069] <- "Channel AVL Number of intrinsic deflections"
colnames(arrhythmia.uci)[070] <- "Channel AVL Existence of ragged R wave"
colnames(arrhythmia.uci)[071] <- "Channel AVL Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[072] <- "Channel AVL Existence of ragged P wave"
colnames(arrhythmia.uci)[073] <- "Channel AVL Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[074] <- "Channel AVL Existence of ragged T wave"
colnames(arrhythmia.uci)[075] <- "Channel AVL Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[076] <- "Channel AVF Q wave Average"
colnames(arrhythmia.uci)[077] <- "Channel AVF R wave Average"
colnames(arrhythmia.uci)[078] <- "Channel AVF S wave Average"
colnames(arrhythmia.uci)[079] <- "Channel AVF R' wave Average"
colnames(arrhythmia.uci)[080] <- "Channel AVF S' wave Average"
colnames(arrhythmia.uci)[081] <- "Channel AVF Number of intrinsic deflections"
colnames(arrhythmia.uci)[082] <- "Channel AVF Existence of ragged R wave"
colnames(arrhythmia.uci)[083] <- "Channel AVF Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[084] <- "Channel AVF Existence of ragged P wave"
colnames(arrhythmia.uci)[085] <- "Channel AVF Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[086] <- "Channel AVF Existence of ragged T wave"
colnames(arrhythmia.uci)[087] <- "Channel AVF Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[088] <- "Channel V1 Q wave Average"
colnames(arrhythmia.uci)[089] <- "Channel V1 R wave Average"
colnames(arrhythmia.uci)[090] <- "Channel V1 S wave Average"
colnames(arrhythmia.uci)[091] <- "Channel V1 R' wave Average"
colnames(arrhythmia.uci)[092] <- "Channel V1 S' wave Average"
colnames(arrhythmia.uci)[093] <- "Channel V1 Number of intrinsic deflections"
colnames(arrhythmia.uci)[094] <- "Channel V1 Existence of ragged R wave"
colnames(arrhythmia.uci)[095] <- "Channel V1 Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[096] <- "Channel V1 Existence of ragged P wave"
colnames(arrhythmia.uci)[097] <- "Channel V1 Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[098] <- "Channel V1 Existence of ragged T wave"
colnames(arrhythmia.uci)[099] <- "Channel V1 Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[100] <- "Channel V2 Q wave Average"
colnames(arrhythmia.uci)[101] <- "Channel V2 R wave Average"
colnames(arrhythmia.uci)[102] <- "Channel V2 S wave Average"
colnames(arrhythmia.uci)[103] <- "Channel V2 R' wave Average"
colnames(arrhythmia.uci)[104] <- "Channel V2 S' wave Average"
colnames(arrhythmia.uci)[105] <- "Channel V2 Number of intrinsic deflections"
colnames(arrhythmia.uci)[106] <- "Channel V2 Existence of ragged R wave"
colnames(arrhythmia.uci)[107] <- "Channel V2 Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[108] <- "Channel V2 Existence of ragged P wave"
colnames(arrhythmia.uci)[109] <- "Channel V2 Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[110] <- "Channel V2 Existence of ragged T wave"
colnames(arrhythmia.uci)[111] <- "Channel V2 Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[112] <- "Channel V3 Q wave Average"
colnames(arrhythmia.uci)[113] <- "Channel V3 R wave Average"
colnames(arrhythmia.uci)[114] <- "Channel V3 S wave Average"
colnames(arrhythmia.uci)[115] <- "Channel V3 R' wave Average"
colnames(arrhythmia.uci)[116] <- "Channel V3 S' wave Average"
colnames(arrhythmia.uci)[117] <- "Channel V3 Number of intrinsic deflections"
colnames(arrhythmia.uci)[118] <- "Channel V3 Existence of ragged R wave"
colnames(arrhythmia.uci)[119] <- "Channel V3 Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[120] <- "Channel V3 Existence of ragged P wave"
colnames(arrhythmia.uci)[121] <- "Channel V3 Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[122] <- "Channel V3 Existence of ragged T wave"
colnames(arrhythmia.uci)[123] <- "Channel V3 Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[124] <- "Channel V4 Q wave Average"
colnames(arrhythmia.uci)[125] <- "Channel V4 R wave Average"
colnames(arrhythmia.uci)[126] <- "Channel V4 S wave Average"
colnames(arrhythmia.uci)[127] <- "Channel V4 R' wave Average"
colnames(arrhythmia.uci)[128] <- "Channel V4 S' wave Average"
colnames(arrhythmia.uci)[129] <- "Channel V4 Number of intrinsic deflections"
colnames(arrhythmia.uci)[130] <- "Channel V4 Existence of ragged R wave"
colnames(arrhythmia.uci)[131] <- "Channel V4 Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[132] <- "Channel V4 Existence of ragged P wave"
colnames(arrhythmia.uci)[133] <- "Channel V4 Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[134] <- "Channel V4 Existence of ragged T wave"
colnames(arrhythmia.uci)[135] <- "Channel V4 Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[136] <- "Channel V5 Q wave Average"
colnames(arrhythmia.uci)[137] <- "Channel V5 R wave Average"
colnames(arrhythmia.uci)[138] <- "Channel V5 S wave Average"
colnames(arrhythmia.uci)[139] <- "Channel V5 R' wave Average"
colnames(arrhythmia.uci)[140] <- "Channel V5 S' wave Average"
colnames(arrhythmia.uci)[141] <- "Channel V5 Number of intrinsic deflections"
colnames(arrhythmia.uci)[142] <- "Channel V5 Existence of ragged R wave"
colnames(arrhythmia.uci)[143] <- "Channel V5 Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[144] <- "Channel V5 Existence of ragged P wave"
colnames(arrhythmia.uci)[145] <- "Channel V5 Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[146] <- "Channel V5 Existence of ragged T wave"
colnames(arrhythmia.uci)[147] <- "Channel V5 Existence of diphasic derivation of T wave"
colnames(arrhythmia.uci)[148] <- "Channel V6 Q wave Average"
colnames(arrhythmia.uci)[149] <- "Channel V6 R wave Average"
colnames(arrhythmia.uci)[150] <- "Channel V6 S wave Average"
colnames(arrhythmia.uci)[151] <- "Channel V6 R' wave Average"
colnames(arrhythmia.uci)[152] <- "Channel V6 S' wave Average"
colnames(arrhythmia.uci)[153] <- "Channel V6 Number of intrinsic deflections"
colnames(arrhythmia.uci)[154] <- "Channel V6 Existence of ragged R wave"
colnames(arrhythmia.uci)[155] <- "Channel V6 Existence of diphasic derivation of R wave"
colnames(arrhythmia.uci)[156] <- "Channel V6 Existence of ragged P wave"
colnames(arrhythmia.uci)[157] <- "Channel V6 Existence of diphasic derivation of P wave"
colnames(arrhythmia.uci)[158] <- "Channel V6 Existence of ragged T wave"
colnames(arrhythmia.uci)[159] <- "Channel V6 Existence of diphasic derivation of T wave"

colnames(arrhythmia.uci)[160] <- "Channel DI JJ wave Amplitude"
colnames(arrhythmia.uci)[161] <- "Channel DI Q wave Amplitude"
colnames(arrhythmia.uci)[162] <- "Channel DI R wave Amplitude"
colnames(arrhythmia.uci)[163] <- "Channel DI S wave Amplitude"
colnames(arrhythmia.uci)[164] <- "Channel DI R' wave Amplitude"
colnames(arrhythmia.uci)[165] <- "Channel DI S' wave Amplitude"
colnames(arrhythmia.uci)[166] <- "Channel DI P wave Amplitude"
colnames(arrhythmia.uci)[167] <- "Channel DI T wave Amplitude"
colnames(arrhythmia.uci)[168] <- "Channel DI QRSA"
colnames(arrhythmia.uci)[169] <- "Channel DI QRSTA"
colnames(arrhythmia.uci)[170] <- "Channel DII JJ wave Amplitude"
colnames(arrhythmia.uci)[171] <- "Channel DII Q wave Amplitude"
colnames(arrhythmia.uci)[172] <- "Channel DII R wave Amplitude"
colnames(arrhythmia.uci)[173] <- "Channel DII S wave Amplitude"
colnames(arrhythmia.uci)[174] <- "Channel DII R' wave Amplitude"
colnames(arrhythmia.uci)[175] <- "Channel DII S' wave Amplitude"
colnames(arrhythmia.uci)[176] <- "Channel DII P wave Amplitude"
colnames(arrhythmia.uci)[177] <- "Channel DII T wave Amplitude"
colnames(arrhythmia.uci)[178] <- "Channel DII QRSA"
colnames(arrhythmia.uci)[179] <- "Channel DII QRSTA"
colnames(arrhythmia.uci)[180] <- "Channel DIII JJ wave Amplitude"
colnames(arrhythmia.uci)[181] <- "Channel DIII Q wave Amplitude"
colnames(arrhythmia.uci)[182] <- "Channel DIII R wave Amplitude"
colnames(arrhythmia.uci)[183] <- "Channel DIII S wave Amplitude"
colnames(arrhythmia.uci)[184] <- "Channel DIII R' wave Amplitude"
colnames(arrhythmia.uci)[185] <- "Channel DIII S' wave Amplitude"
colnames(arrhythmia.uci)[186] <- "Channel DIII P wave Amplitude"
colnames(arrhythmia.uci)[187] <- "Channel DIII T wave Amplitude"
colnames(arrhythmia.uci)[188] <- "Channel DIII QRSA"
colnames(arrhythmia.uci)[189] <- "Channel DIII QRSTA"
colnames(arrhythmia.uci)[190] <- "Channel AVR JJ wave Amplitude"
colnames(arrhythmia.uci)[191] <- "Channel AVR Q wave Amplitude"
colnames(arrhythmia.uci)[192] <- "Channel AVR R wave Amplitude"
colnames(arrhythmia.uci)[193] <- "Channel AVR S wave Amplitude"
colnames(arrhythmia.uci)[194] <- "Channel AVR R' wave Amplitude"
colnames(arrhythmia.uci)[195] <- "Channel AVR S' wave Amplitude"
colnames(arrhythmia.uci)[196] <- "Channel AVR P wave Amplitude"
colnames(arrhythmia.uci)[197] <- "Channel AVR T wave Amplitude"
colnames(arrhythmia.uci)[198] <- "Channel AVR QRSA"
colnames(arrhythmia.uci)[199] <- "Channel AVR QRSTA"
colnames(arrhythmia.uci)[200] <- "Channel AVL JJ wave Amplitude"
colnames(arrhythmia.uci)[201] <- "Channel AVL Q wave Amplitude"
colnames(arrhythmia.uci)[202] <- "Channel AVL R wave Amplitude"
colnames(arrhythmia.uci)[203] <- "Channel AVL S wave Amplitude"
colnames(arrhythmia.uci)[204] <- "Channel AVL R' wave Amplitude"
colnames(arrhythmia.uci)[205] <- "Channel AVL S' wave Amplitude"
colnames(arrhythmia.uci)[206] <- "Channel AVL P wave Amplitude"
colnames(arrhythmia.uci)[207] <- "Channel AVL T wave Amplitude"
colnames(arrhythmia.uci)[208] <- "Channel AVL QRSA"
colnames(arrhythmia.uci)[209] <- "Channel AVL QRSTA"
colnames(arrhythmia.uci)[210] <- "Channel AVF JJ wave Amplitude"
colnames(arrhythmia.uci)[211] <- "Channel AVF Q wave Amplitude"
colnames(arrhythmia.uci)[212] <- "Channel AVF R wave Amplitude"
colnames(arrhythmia.uci)[213] <- "Channel AVF S wave Amplitude"
colnames(arrhythmia.uci)[214] <- "Channel AVF R' wave Amplitude"
colnames(arrhythmia.uci)[215] <- "Channel AVF S' wave Amplitude"
colnames(arrhythmia.uci)[216] <- "Channel AVF P wave Amplitude"
colnames(arrhythmia.uci)[217] <- "Channel AVF T wave Amplitude"
colnames(arrhythmia.uci)[218] <- "Channel AVF QRSA"
colnames(arrhythmia.uci)[219] <- "Channel AVF QRSTA"
colnames(arrhythmia.uci)[220] <- "Channel V1 JJ wave Amplitude"
colnames(arrhythmia.uci)[221] <- "Channel V1 Q wave Amplitude"
colnames(arrhythmia.uci)[222] <- "Channel V1 R wave Amplitude"
colnames(arrhythmia.uci)[223] <- "Channel V1 S wave Amplitude"
colnames(arrhythmia.uci)[224] <- "Channel V1 R' wave Amplitude"
colnames(arrhythmia.uci)[225] <- "Channel V1 S' wave Amplitude"
colnames(arrhythmia.uci)[226] <- "Channel V1 P wave Amplitude"
colnames(arrhythmia.uci)[227] <- "Channel V1 T wave Amplitude"
colnames(arrhythmia.uci)[228] <- "Channel V1 QRSA"
colnames(arrhythmia.uci)[229] <- "Channel V1 QRSTA"
colnames(arrhythmia.uci)[230] <- "Channel V2 JJ wave Amplitude"
colnames(arrhythmia.uci)[231] <- "Channel V2 Q wave Amplitude"
colnames(arrhythmia.uci)[232] <- "Channel V2 R wave Amplitude"
colnames(arrhythmia.uci)[233] <- "Channel V2 S wave Amplitude"
colnames(arrhythmia.uci)[234] <- "Channel V2 R' wave Amplitude"
colnames(arrhythmia.uci)[235] <- "Channel V2 S' wave Amplitude"
colnames(arrhythmia.uci)[236] <- "Channel V2 P wave Amplitude"
colnames(arrhythmia.uci)[237] <- "Channel V2 T wave Amplitude"
colnames(arrhythmia.uci)[238] <- "Channel V2 QRSA"
colnames(arrhythmia.uci)[239] <- "Channel V2 QRSTA"
colnames(arrhythmia.uci)[240] <- "Channel V3 JJ wave Amplitude"
colnames(arrhythmia.uci)[241] <- "Channel V3 Q wave Amplitude"
colnames(arrhythmia.uci)[242] <- "Channel V3 R wave Amplitude"
colnames(arrhythmia.uci)[243] <- "Channel V3 S wave Amplitude"
colnames(arrhythmia.uci)[244] <- "Channel V3 R' wave Amplitude"
colnames(arrhythmia.uci)[245] <- "Channel V3 S' wave Amplitude"
colnames(arrhythmia.uci)[246] <- "Channel V3 P wave Amplitude"
colnames(arrhythmia.uci)[247] <- "Channel V3 T wave Amplitude"
colnames(arrhythmia.uci)[248] <- "Channel V3 QRSA"
colnames(arrhythmia.uci)[249] <- "Channel V3 QRSTA"
colnames(arrhythmia.uci)[250] <- "Channel V4 JJ wave Amplitude"
colnames(arrhythmia.uci)[251] <- "Channel V4 Q wave Amplitude"
colnames(arrhythmia.uci)[252] <- "Channel V4 R wave Amplitude"
colnames(arrhythmia.uci)[253] <- "Channel V4 S wave Amplitude"
colnames(arrhythmia.uci)[254] <- "Channel V4 R' wave Amplitude"
colnames(arrhythmia.uci)[255] <- "Channel V4 S' wave Amplitude"
colnames(arrhythmia.uci)[256] <- "Channel V4 P wave Amplitude"
colnames(arrhythmia.uci)[257] <- "Channel V4 T wave Amplitude"
colnames(arrhythmia.uci)[258] <- "Channel V4 QRSA"
colnames(arrhythmia.uci)[259] <- "Channel V4 QRSTA"
colnames(arrhythmia.uci)[260] <- "Channel V5 JJ wave Amplitude"
colnames(arrhythmia.uci)[261] <- "Channel V5 Q wave Amplitude"
colnames(arrhythmia.uci)[262] <- "Channel V5 R wave Amplitude"
colnames(arrhythmia.uci)[263] <- "Channel V5 S wave Amplitude"
colnames(arrhythmia.uci)[264] <- "Channel V5 R' wave Amplitude"
colnames(arrhythmia.uci)[265] <- "Channel V5 S' wave Amplitude"
colnames(arrhythmia.uci)[266] <- "Channel V5 P wave Amplitude"
colnames(arrhythmia.uci)[267] <- "Channel V5 T wave Amplitude"
colnames(arrhythmia.uci)[268] <- "Channel V5 QRSA"
colnames(arrhythmia.uci)[269] <- "Channel V5 QRSTA"
colnames(arrhythmia.uci)[270] <- "Channel V6 JJ wave Amplitude"
colnames(arrhythmia.uci)[271] <- "Channel V6 Q wave Amplitude"
colnames(arrhythmia.uci)[272] <- "Channel V6 R wave Amplitude"
colnames(arrhythmia.uci)[273] <- "Channel V6 S wave Amplitude"
colnames(arrhythmia.uci)[274] <- "Channel V6 R' wave Amplitude"
colnames(arrhythmia.uci)[275] <- "Channel V6 S' wave Amplitude"
colnames(arrhythmia.uci)[276] <- "Channel V6 P wave Amplitude"
colnames(arrhythmia.uci)[277] <- "Channel V6 T wave Amplitude"
colnames(arrhythmia.uci)[278] <- "Channel V6 QRSA"
colnames(arrhythmia.uci)[279] <- "Channel V6 QRSTA"

colnames(arrhythmia.uci)[280] <- "Class code"

```




```{r Analysis Redefine types, include = FALSE}
# Redefine some type of the predictor from initial read from files. if using R 3.6 or earlier:
arrhythmia <- arrhythmia.uci %>% mutate(Sex = as.factor( ifelse(Sex == 0, 'M', 'F')),
                                        `T interval`= as.integer(`T interval`),
                                        `P interval` = as.integer(`P interval`),
                                        `QRST Vector angles` = as.integer(`QRST Vector angles`),
                                        `T Vector angles` = as.integer(`T Vector angles`),
                                        `P Vector angles` = as.integer(`P Vector angles`),
                                        `J Vector angles` = as.integer(`J Vector angles`),
                                        `Heart rate` = as.integer(`Heart rate`),
                                        `Channel DI Existence of ragged R wave` = as.factor(`Channel DI Existence of ragged R wave`),
                                        `Channel DI Existence of diphasic derivation of R wave` = as.factor(`Channel DI Existence of diphasic derivation of R wave`),
                                        `Channel DI Existence of ragged P wave` = as.factor(`Channel DI Existence of ragged P wave`),
                                        `Channel DI Existence of diphasic derivation of P wave` = as.factor(`Channel DI Existence of diphasic derivation of P wave`),
                                        `Channel DI Existence of ragged T wave` = as.factor(`Channel DI Existence of ragged T wave`),
                                        `Channel DI Existence of diphasic derivation of T wave` = as.factor(`Channel DI Existence of diphasic derivation of T wave`),
                                        `Channel DII Existence of ragged R wave` = as.factor(`Channel DII Existence of ragged R wave`),
                                        `Channel DII Existence of diphasic derivation of R wave` = as.factor(`Channel DII Existence of diphasic derivation of R wave`),
                                        `Channel DII Existence of ragged P wave` = as.factor(`Channel DII Existence of ragged P wave`),
                                        `Channel DII Existence of diphasic derivation of P wave` = as.factor(`Channel DII Existence of diphasic derivation of P wave`),
                                        `Channel DII Existence of ragged T wave` = as.factor(`Channel DII Existence of ragged T wave`),
                                        `Channel DII Existence of diphasic derivation of T wave` = as.factor(`Channel DII Existence of diphasic derivation of T wave`),
                                        `Channel DIII Existence of ragged R wave` = as.factor(`Channel DIII Existence of ragged R wave`),
                                        `Channel DIII Existence of diphasic derivation of R wave` = as.factor(`Channel DIII Existence of diphasic derivation of R wave`),
                                        `Channel DIII Existence of ragged P wave` = as.factor(`Channel DIII Existence of ragged P wave`),
                                        `Channel DIII Existence of diphasic derivation of P wave` = as.factor(`Channel DIII Existence of diphasic derivation of P wave`),
                                        `Channel DIII Existence of ragged T wave` = as.factor(`Channel DIII Existence of ragged T wave`),
                                        `Channel DIII Existence of diphasic derivation of T wave` = as.factor(`Channel DIII Existence of diphasic derivation of T wave`),
                                        `Channel AVR Existence of ragged R wave` = as.factor(`Channel AVR Existence of ragged R wave`),
                                        `Channel AVR Existence of diphasic derivation of R wave` = as.factor(`Channel AVR Existence of diphasic derivation of R wave`),
                                        `Channel AVR Existence of ragged P wave` = as.factor(`Channel AVR Existence of ragged P wave`),
                                        `Channel AVR Existence of diphasic derivation of P wave` = as.factor(`Channel AVR Existence of diphasic derivation of P wave`),
                                        `Channel AVR Existence of ragged T wave` = as.factor(`Channel AVR Existence of ragged T wave`),
                                        `Channel AVR Existence of diphasic derivation of T wave` = as.factor(`Channel AVR Existence of diphasic derivation of T wave`),
                                        `Channel AVL Existence of ragged R wave` = as.factor(`Channel AVL Existence of ragged R wave`),
                                        `Channel AVL Existence of diphasic derivation of R wave` = as.factor(`Channel AVL Existence of diphasic derivation of R wave`),
                                        `Channel AVL Existence of ragged P wave` = as.factor(`Channel AVL Existence of ragged P wave`),
                                        `Channel AVL Existence of diphasic derivation of P wave` = as.factor(`Channel AVL Existence of diphasic derivation of P wave`),
                                        `Channel AVL Existence of ragged T wave` = as.factor(`Channel AVL Existence of ragged T wave`),
                                        `Channel AVL Existence of diphasic derivation of T wave` = as.factor(`Channel AVL Existence of diphasic derivation of T wave`),
                                        `Channel AVF Existence of ragged R wave` = as.factor(`Channel AVF Existence of ragged R wave`),
                                        `Channel AVF Existence of diphasic derivation of R wave` = as.factor(`Channel AVF Existence of diphasic derivation of R wave`),
                                        `Channel AVF Existence of ragged P wave` = as.factor(`Channel AVF Existence of ragged P wave`),
                                        `Channel AVF Existence of diphasic derivation of P wave` = as.factor(`Channel AVF Existence of diphasic derivation of P wave`),
                                        `Channel AVF Existence of ragged T wave` = as.factor(`Channel AVF Existence of ragged T wave`),
                                        `Channel AVF Existence of diphasic derivation of T wave` = as.factor(`Channel AVF Existence of diphasic derivation of T wave`),
                                        `Channel V1 Existence of ragged R wave` = as.factor(`Channel V1 Existence of ragged R wave`),
                                        `Channel V1 Existence of diphasic derivation of R wave` = as.factor(`Channel V1 Existence of diphasic derivation of R wave`),
                                        `Channel V1 Existence of ragged P wave` = as.factor(`Channel V1 Existence of ragged P wave`),
                                        `Channel V1 Existence of diphasic derivation of P wave` = as.factor(`Channel V1 Existence of diphasic derivation of P wave`),
                                        `Channel V1 Existence of ragged T wave` = as.factor(`Channel V1 Existence of ragged T wave`),
                                        `Channel V1 Existence of diphasic derivation of T wave` = as.factor(`Channel V1 Existence of diphasic derivation of T wave`),
                                        `Channel V2 Existence of ragged R wave` = as.factor(`Channel V2 Existence of ragged R wave`),
                                        `Channel V2 Existence of diphasic derivation of R wave` = as.factor(`Channel V2 Existence of diphasic derivation of R wave`),
                                        `Channel V2 Existence of ragged P wave` = as.factor(`Channel V2 Existence of ragged P wave`),
                                        `Channel V2 Existence of diphasic derivation of P wave` = as.factor(`Channel V2 Existence of diphasic derivation of P wave`),
                                        `Channel V2 Existence of ragged T wave` = as.factor(`Channel V2 Existence of ragged T wave`),
                                        `Channel V2 Existence of diphasic derivation of T wave` = as.factor(`Channel V2 Existence of diphasic derivation of T wave`),
                                        `Channel V3 Existence of ragged R wave` = as.factor(`Channel V3 Existence of ragged R wave`),
                                        `Channel V3 Existence of diphasic derivation of R wave` = as.factor(`Channel V3 Existence of diphasic derivation of R wave`),
                                        `Channel V3 Existence of ragged P wave` = as.factor(`Channel V3 Existence of ragged P wave`),
                                        `Channel V3 Existence of diphasic derivation of P wave` = as.factor(`Channel V3 Existence of diphasic derivation of P wave`),
                                        `Channel V3 Existence of ragged T wave` = as.factor(`Channel V3 Existence of ragged T wave`),
                                        `Channel V3 Existence of diphasic derivation of T wave` = as.factor(`Channel V3 Existence of diphasic derivation of T wave`),
                                        `Channel V4 Existence of ragged R wave` = as.factor(`Channel V4 Existence of ragged R wave`),
                                        `Channel V4 Existence of diphasic derivation of R wave` = as.factor(`Channel V4 Existence of diphasic derivation of R wave`),
                                        `Channel V4 Existence of ragged P wave` = as.factor(`Channel V4 Existence of ragged P wave`),
                                        `Channel V4 Existence of diphasic derivation of P wave` = as.factor(`Channel V4 Existence of diphasic derivation of P wave`),
                                        `Channel V4 Existence of ragged T wave` = as.factor(`Channel V4 Existence of ragged T wave`),
                                        `Channel V4 Existence of diphasic derivation of T wave` = as.factor(`Channel V4 Existence of diphasic derivation of T wave`),
                                        `Channel V5 Existence of ragged R wave` = as.factor(`Channel V5 Existence of ragged R wave`),
                                        `Channel V5 Existence of diphasic derivation of R wave` = as.factor(`Channel V5 Existence of diphasic derivation of R wave`),
                                        `Channel V5 Existence of ragged P wave` = as.factor(`Channel V5 Existence of ragged P wave`),
                                        `Channel V5 Existence of diphasic derivation of P wave` = as.factor(`Channel V5 Existence of diphasic derivation of P wave`),
                                        `Channel V5 Existence of ragged T wave` = as.factor(`Channel V5 Existence of ragged T wave`),
                                        `Channel V5 Existence of diphasic derivation of T wave` = as.factor(`Channel V5 Existence of diphasic derivation of T wave`),
                                        `Channel V6 Existence of ragged R wave` = as.factor(`Channel V6 Existence of ragged R wave`),
                                        `Channel V6 Existence of diphasic derivation of R wave` = as.factor(`Channel V6 Existence of diphasic derivation of R wave`),
                                        `Channel V6 Existence of ragged P wave` = as.factor(`Channel V6 Existence of ragged P wave`),
                                        `Channel V6 Existence of diphasic derivation of P wave` = as.factor(`Channel V6 Existence of diphasic derivation of P wave`),
                                        `Channel V6 Existence of ragged T wave` = as.factor(`Channel V6 Existence of ragged T wave`),
                                        `Channel V6 Existence of diphasic derivation of T wave` = as.factor(`Channel V6 Existence of diphasic derivation of T wave`),
                                        `Class code` = as.factor(`Class code`)
                                        )

```



As a result of this transformation, we have a "well defined" new dataset (only first 25 variables of 280 are showed):

```{r Analysis new structure, echo=FALSE}
# Display predictors (columns) of the new dataset
str(arrhythmia, list.len = 25)
```

## Cleaning

The first analysis is to review if all the predictor give information. For that we are going to check if all the values of the dataset are equal, e. gr., it has standard deviation equal to zero. We are going to detect them.

```{r Analysis Cleaning,warning=FALSE}
sd.arrhythmia <- apply(arrhythmia,2,sd, na.rm=TRUE)
sd0.list.arrhythmia <- names(sd.arrhythmia[sd.arrhythmia == 0 & !is.na(sd.arrhythmia)]) # check is.na......

# Identify the column number to be deleted
ix <- which(colnames(arrhythmia) %in% sd0.list.arrhythmia)
variable.names(arrhythmia[ix])

```
 and delete them:
```{r Analysis Cleaning delete columns}

arrhythmia <- arrhythmia[,-ix]
```




## Cleaning, working with NA

As we mention before, some values are not defined. Initially they are "?" and we change for NA. This table show us which predictor are involve and how many they are:

```{r Analysis Cleaning working with NA, echo = FALSE, warning=FALSE}
# counts the number of NAs per column, resulting in:
colna <- colSums(is.na(arrhythmia))
colna <- colna[colna > 0]
colna %>% knitr::kable(caption = 'Table of Ocurrence of NA', col.names = c( 'Ocurrences')) %>%
  kable_styling(full_width = F, position = "left")
```

The algorithms required that all the columns has values. How are we going to proceed with this missing values?

### Missing J Vector angles

Because we have a big number of this missing values (`r round(100*colna[4]/nrow(arrhythmia),digits = 1)`%) the better solution it is not consider this predictor.

```{r Delete J Vector angles Predictor}

arrhythmia <- arrhythmia %>% select(-`J Vector angles`)

```


### Missing P Vector angles

This is not as big as the previous one, only `r round(100*colna[2]/nrow(arrhythmia),digits = 1)`%, let's see how it is distributed

```{r Missing P Vector angles Summary, echo = FALSE}
summary(arrhythmia$`P Vector angles`)
```

```{r Missing P Vector angles Histogram, echo = FALSE, message=FALSE, warning=FALSE}
arrhythmia %>% ggplot(aes(`P Vector angles`)) + geom_histogram() + 
  geom_vline( xintercept = mean(arrhythmia$`P Vector angles`,na.rm = TRUE), colour = "blue") +
  geom_vline( xintercept = median(arrhythmia$`P Vector angles`,na.rm = TRUE), colour = "green")
```

This show in blue the mean and in green the median for this predictors. We are going to use the median which look more independent of the low values that look like an outsiders.


```{r Missing P Vector angles replacement}
arrhythmia$`P Vector angles`[is.na(arrhythmia$`P Vector angles`)] <- median(arrhythmia$`P Vector angles`,na.rm = TRUE)
```


### Missing T Vector angles


This is smaller number of the previous one, only `r round(100*colna[1]/nrow(arrhythmia),digits = 1)`%, let's see how it is distributed

```{r Missing T Vector angles Summary, echo = FALSE}
summary(arrhythmia$`T Vector angles`)
```

```{r Missing T Vector angles Histogram, echo = FALSE, message=FALSE, warning=FALSE}
arrhythmia %>% ggplot(aes(`T Vector angles`)) + geom_histogram() + 
  geom_vline( xintercept = mean(arrhythmia$`T Vector angles`,na.rm = TRUE), colour = "blue") +
  geom_vline( xintercept = median(arrhythmia$`T Vector angles`,na.rm = TRUE), colour = "green") + 
  ggtitle("Histogram of T Vector angles")
```

This show in blue the mean and in green the median for this predictors. We are going to use the median which look more independent of the low values as before.


```{r Missing T Vector angles replacement}
arrhythmia$`T Vector angles`[is.na(arrhythmia$`T Vector angles`)] <- median(arrhythmia$`T Vector angles`,na.rm = TRUE)
```



### Missing QRST Vector angles

This is only one missing value and represent the `r round(100*colna[3]/nrow(arrhythmia),digits = 1)`%, let's see some data for this missing:


```{r Missing QRST Vector angles analysis, echo=FALSE}
arrhythmia %>% filter(is.na(`QRST Vector angles`)) %>% select(Age, Sex, Height, Weight, `QRS duration`,`P-R interval`, `Q-T interval`, `T interval`, `P interval` ,`QRS Vector angles`)
```
Let's do the same analysis about the distribution:

```{r Missing QRST Vector angles Summary, echo = FALSE}
summary(arrhythmia$`QRST Vector angles`)
```

```{r Missing QRST Vector angles Histogram, echo = FALSE, message=FALSE, warning=FALSE}
arrhythmia %>% ggplot(aes(`QRST Vector angles`)) + geom_histogram() + 
  geom_vline( xintercept = mean(arrhythmia$`QRST Vector angles`,na.rm = TRUE), colour = "blue") +
  geom_vline( xintercept = median(arrhythmia$`QRST Vector angles`,na.rm = TRUE), colour = "green") + 
  ggtitle("Histogram of QRST Vector angles")
```

This show in blue the mean and in green the median for this predictors. We are going to use the median which look more independent of the low values as before.

```{r Missing QRST Vector angles replacement}
arrhythmia$`QRST Vector angles`[is.na(arrhythmia$`QRST Vector angles`)] <- median(arrhythmia$`QRST Vector angles`,na.rm = TRUE)
```



### Missing Heart rate

This is only one missing value and represent the `r round(100*colna[5]/nrow(arrhythmia),digits = 1)`%, let's see some data fo this missing:


```{r Missing Heart rate Analysis, echo=FALSE}
arrhythmia %>% filter(is.na(`Heart rate`)) %>% select(Age, Sex, Height, Weight, `QRS duration`,`P-R interval`, `Q-T interval`, `T interval`, `P interval` ,`QRS Vector angles`)
```
Let's do the same analysis about the distribution:

```{r Missing Heart rate Summary, echo = FALSE}
summary(arrhythmia$`Heart rate`)
```

```{r Missing Heart rate Histogram, echo = FALSE, message=FALSE, warning=FALSE}
arrhythmia %>% ggplot(aes(`Heart rate`)) + geom_histogram() + 
  geom_vline( xintercept = mean(arrhythmia$`Heart rate`,na.rm = TRUE), colour = "blue") +
  geom_vline( xintercept = median(arrhythmia$`Heart rate`,na.rm = TRUE), colour = "green") + 
  ggtitle("Histogram of Heart rate")
```

This show in blue the mean and in green the median for this predictors. In this case both values are pretty close. We are going to use the median anyway.

```{r Missing Heart rate replacement}
arrhythmia$`Heart rate`[is.na(arrhythmia$`Heart rate`)] <- median(arrhythmia$`Heart rate`,na.rm = TRUE)
```


## Correlation

When we use the median in the section abode, we assume that the data is not related with other predictor. Is this true? Now that we have data we can check if this is correct for each predictor we keep.

For this answer we are going to use correlation between the predictors.

```{r Correlation, echo=FALSE}
data_numeric <- select_if(arrhythmia, is.numeric)             # Subset numeric columns only
cor_data_numeric <- cor(data_numeric)

#given matrix with entries TRUE in the lower  triangle. With this I use half of the matrix, because it is symmetric to de diagonal and only need the data one time (cor(a,b = cor(b,a)))
# The diagonal it is set to NA because is 1 but I do not needed for computing (cor(a,a) = 1)
cor_data_numeric[lower.tri(cor_data_numeric, diag = TRUE)] <- NA # Should the diagonal be included?
```



For this table the more positive correlated are:
```{r Correlation creating the tidy table, echo=FALSE,warning=FALSE}
data2 <- data.frame(cor_data_numeric, check.names = FALSE)   
data2 <- tibble::rownames_to_column(data2, "correlated.1") # Apply rownames_to_column
cor_arrhythmia_numeric <- data2 %>%  gather(correlated.2,value,2:ncol(data2))
cor_arrhythmia_numeric %>% slice_max(order_by = value, n = 10) %>% knitr::kable(caption = "Top 10 Correlation between predictors")
```





How many are correlated more than .9?
```{r Correlation with limit, echo=FALSE, warning=FALSE}
limit <- 0.9
cor_arrhythmia_numeric %>% filter(value < -limit | value > limit) %>% count() %>% knitr::kable( caption = "Correlation over 0.9 & under -0.9") %>%
  kable_styling(full_width = F, position = "left")
```





This number indicate that the second predictor (or the first if you prefer) does not give us valuable information. But how are these distributed?

```{r Correlation histogram, echo=FALSE}
cor_arrhythmia_numeric %>% ggplot(aes(value)) + geom_histogram(bins = 20,na.rm = TRUE) + ggtitle("Distribution of Correlation between Predictors") + xlab("Correlation")
```

Only few are high correlated. This is good for our analysis.

### Correlation of previous missing values

In the previous predictor that we have missing values, are some others predictor which has complete information are high correlated?


#### Correlation of P Vector angles

Let's start with P Vector angles, where we have 22 missing values.
```{r Correlation of previous missing values P Vector angles, echo=FALSE, warning=FALSE}

cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "P Vector angles" | correlated.2 %in% "P Vector angles") %>% slice_max(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for P Vector angles") %>%
  kable_styling(full_width = F, position = "left")
cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "P Vector angles" | correlated.2 %in% "P Vector angles") %>% slice_min(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for P Vector angles") %>%
  kable_styling(full_width = F, position = "left")
```
here we have a value of `r cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "P Vector angles" | correlated.2 %in% "P Vector angles") %>% slice_max(order_by = value) `. If this predictor appear in the final algorithm, let take this in consideration.


#### Correlation of T Vector angles

With T Vector angles, where we have 8 missing values.
```{r Correlation of T Vector angles, echo=FALSE, warning=FALSE}

cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "T Vector angles" | correlated.2 %in% "T Vector angles") %>% slice_max(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for T Vector angles") %>%
  kable_styling(full_width = F, position = "left")
cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "T Vector angles" | correlated.2 %in% "T Vector angles") %>% slice_min(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for T Vector angles") %>%
  kable_styling(full_width = F, position = "left")
```

The correlation here is lower. Then the assumtion of independant behaivor look valid.


#### Correlation of QRST Vector angles

In the case of QRST Vector angles, with only one value missing, we have

```{r Correlation of QRST Vector angles, echo=FALSE, warning=FALSE}

cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "QRST Vector angles" | correlated.2 %in% "QRST Vector angles") %>% slice_max(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for QRST Vector angles") %>%
  kable_styling(full_width = F, position = "left")
cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "QRST Vector angles" | correlated.2 %in% "QRST Vector angles") %>% slice_min(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for QRST Vector angles") %>%
  kable_styling(full_width = F, position = "left")
```


#### Correlation of Heart rate
And the "Heart rate", with only one missing value

```{r Correlation Heart rate, echo=FALSE, warning=FALSE}

cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "Heart rate" | correlated.2 %in% "Heart rate") %>% slice_max(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for Heart rate") %>%
  kable_styling(full_width = F, position = "left")
cor_arrhythmia_numeric %>%  filter( correlated.1 %in% "Heart rate" | correlated.2 %in% "Heart rate") %>% slice_min(order_by = value, n = 5) %>% knitr::kable(caption = "Correlation for Heart rate") %>%
  kable_styling(full_width = F, position = "left")
```

and this predictor has very low correlation with all the rest of the predictor


#### Less Correlation
Less correlated predictors are also presented and as we saw in the histogram, they are the most common. For example for the correlation between -0.001 and 0.001 we have:
```{r Correlation Less Correlated, echo=FALSE, warning=FALSE}
limit <- 0.0001
cor_arrhythmia_numeric %>% filter(value > -limit & value < limit)  %>% knitr::kable(caption = "Less Correlated Preditors") %>%
  kable_styling(full_width = F, position = "left")
```






## Outliers

Let's take a look to some predictors to see if we can find some outliers. Outliers in statistics are considered as the data values which differ considerably from the bulk of a given data set. These data values lie outside the overall trend, which could be lies in the data.
Let's start with some familiar predictors like Age.

```{r Outliers Age Boxplot, echo=FALSE}
arrhythmia %>% ggplot(aes(Age)) + geom_boxplot(fill="steelblue") + ggtitle("Age Outliers")
```

It does not show any value we can detect as outlier.

Let's continue with Height. Height are in centimeters.

```{r Outliers Height Boxplot, echo=FALSE}
arrhythmia %>% ggplot(aes(Height)) + geom_boxplot() + ggtitle("Height Outliers")
```

We see two vales out of natural range:
```{r Outliers Height Max, echo=FALSE}
slice_max(arrhythmia, order_by = Height, n = 2) %>% select(Height)
```
Let's take a look. Can we change for the means o median? Yes, but let's see if we can get more information that can lead us to the right data.
Could be a transcription error from US norm and really means 6 feet 8 inches (203 cm) and 7 feet 8 inches (233 cm)?
More information we can get from the data:
```{r Outliers Height in detail, echo=FALSE}
slice_max(arrhythmia, order_by = Height, n = 2) %>% select(Age,Weight, Height)
```
They are infants! Then, we can assume, the error is they put the height in mm instead of cm! No other patience less than a year is in the dataset and with one year old there is other one with more weight. For a more precise data maybe a weight-height chat for age can be used. Then we change these values assuming an error in the unit:

```{r Outliers Height fixing}
arrhythmia[arrhythmia$Height == 780,3] <- 78   # Height is column 3
arrhythmia[arrhythmia$Height == 608,3] <- 61   # Height is column 3

```


About the weight in kilograms we have the graph:

```{r Outliers Weight Boxplot, echo=FALSE}
arrhythmia %>% ggplot(aes(Weight)) + geom_boxplot() + ggtitle("Weight Outliers")
```

Looking in more detail this patience:

```{r Outliers Weight Table with Age and Height, echo=FALSE}
slice_max(arrhythmia, order_by = Weight) %>% select(Age,Weight, Height)
```
looks plausible and no change will be made.


About the Heart rate in frequency in minutes (Number of heart beats per minute) we have the graph:

```{r Outliers Heart rate Boxplot, echo=FALSE}
arrhythmia %>% ggplot(aes(`Heart rate`)) + geom_boxplot() + ggtitle("Heart rate Outliers")
```

In the upper numbers:

```{r Outliers Heart rate in detail, echo=FALSE}
slice_max(arrhythmia, order_by = `Heart rate`, n = 2) %>% select(Age,Weight, Height,`Heart rate`)
```

It is look like a possible value (I am not a medical doctor!)



For the predictor above we use our knowledge about the human. A person can not be 7 meter tall, but for the rest, we can review them but for evaluate if it is an outlier and which value can be used to fixed required medical knowledge.





















## Train and validation dataset

After this analysis and cleaning we are ready to create our training and validation dataset. Because our universe of observation is only `r nrow(arrhythmia)` we are going to split 80%-20%.

```{r Create train set, validation set, include = FALSE}
##########################################################
# Create train set, validation set (final hold-out test set)
##########################################################

# Validation set will be 20% of data
set.seed(1, sample.kind="Rounding") # if using R 3.5 or earlier, use `set.seed(1)`
test_index <- createDataPartition(y = arrhythmia$`Class code`, times = 1, p = 0.2, list = FALSE)
train_set <- arrhythmia[-test_index,]
validation_set <- arrhythmia[test_index,]


dim(train_set)
dim(validation_set)




rm(dl, ratings, movies, test_index, temp, removed)
```

We are going to use "Class code" as an outcome to predict. Because some outcome are too few as we saw before, we need that they are present in the train_set and validation_set. This task should be manager with the createDataPartition() function, but we are going to check anyway.


```{r Create train set check Class code}
unique(train_set$`Class code`) %>% sort()
unique(validation_set$`Class code`) %>% sort()
```


We can see in detail the Class code distribution in both dataset.


## check train_set dataset


```{r  Create train set check train_set, echo=FALSE, message=FALSE, warning=FALSE}
left_join(train_set, Class, by = "Class code") %>% 
  group_by(`Class code`, `Class name`) %>% summarise( "N Ocurrences" = n(), Percentage = round(100*n()/nrow(train_set),digits = 1)) %>%
  knitr::kable(caption = "Presence of codes in train_set dataset")
  
```

## check validation_set dataset

```{r  Create train set check validation_set, echo=FALSE, message=FALSE, warning=FALSE}
left_join(validation_set, Class, by = "Class code") %>% 
  group_by(`Class code`, `Class name`) %>% summarise( "N Ocurrences" = n(), Percentage = round(100*n()/nrow(validation_set),digits = 1)) %>%
  knitr::kable(caption = "Presence of codes in validation_set dataset")
  
```

We can see that the percentage of the different classes are not equally distributes in both dataset. Why? Because it is not possible to have the same percentage when there is a few sample in some of them in the initial dataset. For example, Class 8	"Supraventricular Premature Contraction" has only 2 samples, them the function distribute in the 2 dataset and because the total number of samples are different, its percentage is different. This change if we move the partition from 80%-20% to 50%-50% but less samples are left for training propose. This is part of the consideration when we chose this proportion at the beginning.

But this is not the only check we need to perform: we need to see if all the data (predictors) are not equal in this new dataset.
Remember that we check initially in the arrhythmia dataset that this situation does not occurs, but this can be present in this new (and small) dataset. Particularly with factors, if we have one value only we can get the error: "contrasts can be applied only to factors with 2 or more levels" with the train() function.


```{r Create train set Unique value in train_set, echo=FALSE}
values_count <- sapply(lapply(train_set, unique), length)  # Identify variables with 1 value
variable.names(train_set[values_count == 1])
```

We see we have `r sum(values_count  == 1)` predictors in this new dataset with equal value, for that we need to delete from train_set and validation_set dataset:

```{r Create train set delete predictors with not varianza in the train_set}
train_set <- train_set[,values_count > 1]
validation_set <- validation_set[,values_count > 1]
```

After all this process, we finish with `r length(train_set) -1` prodictors from the initial `r length(arrhythmia.uci) -1`.


In summary, related with the prediction we are going to perform:  
* The first prediction is if we can predict is the patience is normal or has one of the 15 arrhythmia.  
* The second prediction, as you probably guess, is if we can categorize the right class.












```{r Analysis delete unwanted onjects, echo=FALSE}
rm(data_numeric, data2, cor_data_numeric, colna, ix, sd0.list.arrhythmia, sd.arrhythmia, values_count, limit)
```


.........
Error in `contrasts<-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : contrasts can be applied only to factors with 2 or more levels
 $ Channel V5 Existence of ragged R wave                  : Factor w/ 1 level "0": 1 1 1 1 1 1 1 1 1 1 ...


Looking at the error message and your dataset's variables, the variable BorrowerMetropolitanArea has only one level (Actually it has no predictive value at all if all samples have the same value). I guess this is causing the problem in the contrasts function when you use PCA to pre-process the dataset.

Try calling the train funcion on the dataset without the the variable BorrowerMetropolitanArea.


The reason for this is that one of our predictor variables has only one factor level.


We can do that by using the sapply and lapply functions in combination with the unique and length functions:

values_count <- sapply(lapply(data, unique), length)  # Identify variables with 1 value
values_count                                          # Print counts of different values
# x1 x2 x3  y 
#  4  3  1  5

The previous R code returned a named vector showing the number of different values in each of our columns. As you can see, the variable x3 contains the same value in each data cell.

We can now use this vector to subset our data frame within the lm function so that only variables with more than one value are used as predictors:

lm(y ~ ., data[ , values_count > 1])                  # Apply lm() to subset of data
# Call:
# lm(formula = y ~ ., data = data[, values_count > 1])
# 
# Coefficients:
# (Intercept)           x1           x2  
#      5.8534      -0.4788      -0.2409

The lm functions returns a valid output – looks good!


they are not present in the validation set, but we are going to keep them because two kind of prediction we are going to perform.




We just saw these data that came in the edx. Now the question is: How is it the rating affected by this predictors?

\newpage
